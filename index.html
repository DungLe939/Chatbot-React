<!DOCTYPE html>
<html>

<head>
    <title>Chatbot Project</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Container -->
    <div class="js-container flex items-center justify-center min-h-screen p-4"></div>

    <!-- Scripts -->
    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>
    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script type="text/babel">

        const botAvatar = "https://supersimple.dev/projects/chatbot/robot.png";
        const humanAvatar = "https://supersimple.dev/projects/chatbot/user.png";

        function ChatInput({ chatMessages, setChatMessages }) {
            const [inputText, setInputText] = React.useState('');
            const [isLoading, setIsLoading] = React.useState(false);

            const handleOnSubmit = async () => {
                if (isLoading || inputText === '') return;
                setIsLoading(true);

                const humanText = {
                    id: crypto.randomUUID(),
                    message: inputText,
                    avatar: 'human'
                };
                const loadingBotText = {
                    id: crypto.randomUUID(),
                    message: 'Loading...',
                    avatar: 'bot'
                };

                setChatMessages([...chatMessages, humanText, loadingBotText]);
                setInputText('');
                const newText = await Chatbot.getResponseAsync(inputText);

                const botText = {
                    id: crypto.randomUUID(),
                    message: newText,
                    avatar: 'bot'
                };

                setChatMessages((prevMessages) => {
                    const updatedMessages = [...prevMessages];
                    updatedMessages[updatedMessages.length - 1] = botText;
                    return updatedMessages;
                });
                setIsLoading(false);
            };

            const handleOnReset = () => {
                setChatMessages([]);
            };

            return (
                <div className="flex gap-2 p-4 bg-white rounded-lg shadow-lg">
                    <input
                        type="text"
                        placeholder="Send a message..."
                        value={inputText}
                        onChange={(e) => setInputText(e.target.value)}
                        onKeyDown={(e) => {
                            if (e.key === 'Enter') handleOnSubmit();
                            else if (e.key === 'Escape') handleOnReset();
                        }}
                        className="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                    <button
                        onClick={handleOnSubmit}
                        disabled={isLoading}
                        className="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-medium py-3 px-6 rounded-lg transition active:scale-95"
                    >
                        Send
                    </button>
                    <button
                        onClick={handleOnReset}
                        className="bg-red-500 hover:bg-red-600 text-white font-medium py-3 px-6 rounded-lg transition active:scale-95"
                    >
                        Reset
                    </button>
                </div>
            );
        }

        function ChatMessage({ text, avatar }) {

            const isBot = avatar === 'bot';
            return (
                <div className={`flex items-end gap-3 p-4 ${isBot ? 'justify-start' : 'justify-end'}`}>
                    {isBot && (
                        <img src={botAvatar} alt="Bot" className="w-10 h-10 rounded-full shadow-md" />
                    )}
                    <div
                        className={`max-w-xs px-4 py-3 rounded-lg shadow ${isBot
                            ? 'bg-gray-200 text-gray-800'
                            : 'bg-blue-500 text-white'
                            }`}
                    >
                        {text}
                    </div>
                    {!isBot && (
                        <img src={humanAvatar} alt="User" className="w-10 h-10 rounded-full shadow-md" />
                    )}
                </div>
            );
        }

        function ChatMessageComponent({ chatMessages }) {
            const chatMessageRef = React.useRef(null);

            React.useEffect(() => {
                if (chatMessageRef.current) {
                    chatMessageRef.current.scrollTop = chatMessageRef.current.scrollHeight;
                }
            }, [chatMessages]);

            return (
                <div
                    ref={chatMessageRef}
                    className="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50"
                >
                    {chatMessages.map((message) => (
                        <ChatMessage
                            key={message.id}
                            text={message.message}
                            avatar={message.avatar}
                        />
                    ))}
                </div>
            );
        }

        function App() {
            const [chatMessages, setChatMessages] = React.useState([]);

            return (
                <div className="w-full max-w-2xl h-screen max-h-screen flex flex-col bg-white rounded-xl shadow-2xl overflow-hidden">
                    <div className="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-6">
                        <h1 className="text-2xl font-bold">Chat Assistant</h1>
                    </div>
                    {chatMessages.length === 0 ? (
                        <div className="flex-1 flex items-center justify-center text-gray-400 bg-gray-50">
                            <p>Start a conversation...</p>
                        </div>
                    ) : (
                        <ChatMessageComponent chatMessages={chatMessages} />
                    )}
                    <div className="border-t border-gray-200 p-4">
                        <ChatInput chatMessages={chatMessages} setChatMessages={setChatMessages} />
                    </div>
                </div>
            );
        }

        const container = document.querySelector('.js-container');
        ReactDOM.createRoot(container).render(<App />);
    </script>
</body>

</html>